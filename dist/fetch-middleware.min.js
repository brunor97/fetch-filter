!function(){"use strict";function n(n,r,t){o(n,"before").reverse().forEach(function(n){return n(r,t)})}function r(n,r,t){e(r,o(n,"then"),t)}function t(n,r,t){e(r,o(n,"fail"),t)}function o(n,r){return n.filter(function(n){return n.hasOwnProperty(r)}).map(function(n){return n[r]})}function e(n,r,t){var o=r[0];o?o.apply(void 0,n.concat([function(){return e(n,r.slice(1),t)}])):t()}var i={before:n,done:r,fail:t},u=[];window.addMiddleware=function(n){u.push(n)};var c="Bouncing between rejected and resolved, stopping loop",f=window.fetch;window.fetch=function(n,r){return new Promise(function(t,o){i.before(u,n,r);var e=f(n,r);e.then(function(e){var f=function(){throw o(c),new Error(c)},a=function(t){i.fail(u,[t,n,r,f],function(){return o(t)})};i.done(u,[e,n,r,a],function(){return t(e)})}),e.catch(function(e){var f=function(){throw o(e),new Error(c)},a=function(o){i.done(u,[o,n,r,f],function(){return t(o)})};i.fail(u,[e,n,r,a],function(){return o(e)})})})}}();

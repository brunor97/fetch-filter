<html>

<head>
    <script src='/tests/assert.js'></script>
    <script src='/node_modules/promise-polyfill/promise.min.js'></script>
    <script src='/node_modules/whatwg-fetch/fetch.js'></script>
    <script src='/dist/fetch-filter.min.js'></script>
    <script language='javascript'>
        window.onload = function () {
            parent.run('Modifying response', function () {

                var filterOrder = [];

                addFetchFilter({
                    before: function(settings, options) {
                        if(options.headers) {
                            options.headers["X-TEST"] = "test";
                        }
                        else {
                            options.headers = {
                                "X-TEST": "test"
                            }
                        }
                    }
                });

                addFetchFilter({
                    before: function(settings, options) {
                        assertEquals("test", options.headers["X-TEST"]);
                        next();
                    }
                });

                expectAsserts(1);
                return fetch("grumpy-cat.jpg");
            });
        }
    </script>
</head>

<body>
</body>

</html>